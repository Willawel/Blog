YUI.add("hermes-lang-stats",function(e,t){e.Intl.add("hermes/stats","en-US",{STATS:["Stats"],NUMBER:[{type:"number",valueName:"num"}],NUMBER_VIEWS:[{type:"number",valueName:"num"}," views"],NUMBER_FAVES:[{type:"number",valueName:"num"}," faves"],NUMBER_COMMENTS:[{type:"number",valueName:"num"}," comments"],VIEW_COUNTS:["View Counts"],SO_FAR_TODAY:["So far today"],SO_FAR_TODAY_DOT_DOT_DOT:["So far today..."],YESTERDAY:["Yesterday"],ALL_TIME:["All time"],PHOTOS_AND_VIDEOS:["Photos and Videos"],PHOTOS:["Photos"],VIDEOS:["Videos"],PHOTOSTREAM:["Photostream"],ALBUMS:["Albums"],COLLECTIONS:["Collections"],GALLERIES:["Galleries"],TOTAL:["Total"],TOP_PHOTOS_AND_VIDEOS:["Top photos and videos"],CONTENT_BREAKDOWN:["Content Breakdown <span>(",{type:"number",valueName:"num"}," items)</span>"],VIEWS:["Views"],ALL_TIME_VIEWS:["All Time views"],ALL_TIME_FAVES:["All time faves"],ALL_TIME_COMMENTS:["All time comments"],DATE:["Date"],INTERESTINGNESS:["Interestingness"],FAVORITES:["Favorites"],COMMENTS:["Comments"],RECENT_VIEWS:["Recent views"],RECENT_FAVES:["Recent faves"],RECENT_COMMENTS:["Recent comments"],BACK_TO_STATS:["Back to Stats"],SOURCE_BREAKDOWN:["Source breakdown"],ALL_PHOTO_AND_VIDEOS_LINK:["All photos and videos"],VISITS:["Visits"],PRO_UNTIL_DATE:["PRO until ","${date}"],PRO_SINCE_DATE:["PRO since ","${date}"],PRO_SINCE_MONTHYEAR:["PRO since ",{type:"date",valueName:"intlDate",format:"monthYear"}],PRO_UNTIL_MONTHYEAR:["PRO until ",{type:"date",valueName:"intlDate",format:"monthYear"}],LEARN_MORE:["Learn more"],CURRENT_STATS_DATE:["Stats are shown in GMT, where it's currently ","${time}"," on ","${date}"],CURRENT_STATS_LONGDATE:["Stats are shown in GMT, where it's currently ","${time}"," on ",{type:"date",valueName:"intlDate",format:"long"}],SPACE_USED_LIMITED:["${used}"," of ","${total}"," used"],SPACE_USED_UNLIMITED:["${used}"," of unlimited used"],PUBLIC:["Public"],FRIENDS:["Friends"],FAMILY:["Family"],FF:["Friends and Family"],PRIVATE:["Private"],TAGGED:["Tagged"],GEOTAGGED:["Geotagged"],IN_ALBUMS:["In albums"],IN_GROUPS:["In groups"],VIEWED:["Viewed"],FAVED:["Faved"],COMMENTED:["Commented"],NO_SOURCES_TODAY:["No sources for this day"],NO_VIEWS_TODAY:["No photos have been viewed today"],PERCENTAGE_OF_VIEWS:[{type:"number",valueName:"num"},"% of views"],PERCENTAGE_OF_FAVES:[{type:"number",valueName:"num"},"% of faves"],PERCENTAGE_OF_COMMENTS:[{type:"number",valueName:"num"},"% of comments"],TODAY:["Today"],SOURCES:["Sources"],LOAD_MORE:["Load more"],NEXT:["Next"],PREVIOUS:["Previous"],MEDIA:["Media"],VISIBILITY:["Visibility"],ALPHA_LABEL:["Stats Alpha"],BETA_LABEL:["Stats Beta"],SHOW_ALL:["Show all"],PHOTO_STATS:["Photo stats"],EXPAND_ALL:["Expand all"],COLLAPSE_ALL:["Collapse all"],NO_PHOTO_STATS_AVAILABLE:["No stats available for this photo"],NO_RECENT_PHOTO_STATS_AVAILABLE:["No recent stats available for this photo"],WELCOME_TO_STATS:["Welcome to stats"],WELCOME_MODAL_SCREEN_1:["Easily see your all time data"],WELCOME_MODAL_SCREEN_2:["More powerful navigation"],WELCOME_MODAL_SCREEN_3:["More meaningful data, categories, and social sources"],WELCOME_MODAL_SCREEN_2_QUICK:["Quickly access your data with improved navigation"],WORKING_ON_IT:["We're working on it"],STATS_LOADING:["We're having some trouble displaying stats at the moment. Please try again."],"404_STATS_ONLY_YOU":["Sorry, you can’t see someone else’s stats."]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-comments",function(o,e){o.Intl.add("hermes/comments","en-US",{LOADING:["Loading"],MORE:["more"],ERROR_LOADING_COMMENTS:["Error loading comments"],COULDNT_POST_COMMENT:["We couldn't post your comment"],COULDNT_GET_MORE_COMMENTS:["We couldn't get more comments"],CONFIRM_DELETE:["Confirm Delete"],YES_CONFIRM_DELETE:["Yes, Delete It"],ARE_YOU_SURE_DELETE:["Are you sure you want to delete this comment?"],COULDNT_DELETE_COMMENT:["We couldn't delete your comment"],ERROR:["Error!"],NO_COMMENTS:["No comments"],ADD_A_COMMENT:["Add a comment"],LOGIN_TO_COMMENT:["Login to comment"],MUST_BE_LOGGED_IN_TO_COMMENT:["You must be logged in to post a comment"],LOADING_COMMENTS:["Loading comments..."],SEE_MORE:["See more"],SEE_MORE_LINK:['... <a href="',"${photoUrl}",'">Read more</a>'],SIGNUP_MODAL_TITLE:["Comment on this photo!"],SIGNUP_MODAL_MESSAGE:["Join Flickr to leave a comment on this photo"],VIEW_COMMENTS:["View Comments"],COMMENTING_DISABLED:["Commenting is disabled for this photo."],VIEW_ON_PHOTO_PAGE:["View all comments on the photo page"],ADD_GALLERY_COMMENT:["Add a comment about this gallery"],ADD_PHOTO_COMMENT:["Add a comment about this ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}}]})},"@VERSION@",{requires:["intl"]});YUI.add("comment-list-view",function(e,t){var n=require("hermes-core/flog")(t);e.namespace("Views")["comment-list-view"]=e.Base.create("comment-list-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.modelConfig=e.commentListConfig,this.perPage=this.modelConfig.perPage||16,this.firstPerPage=this.modelConfig.firstPerPage||16,this.commentsPage=0,this.renderedCommentModels=[],this.isSubjectOwner=!1},activate:function(){var e=this.get("container");return e.addClass("comment-list-view"),this.commentsListNode=e.one(".comment-list"),this.registerEventHandler(this.commentsListNode.delegate("click",this.handleCommentActionClick.bind(this),".comment-actions")),this.loadComments()},resetComments:function(){return this.renderedCommentModels=[],this.commentsPage=0,this.commentsListNode.set("innerHTML",""),this.loadComments()},loadComments:function(){var t=this,o=t.appContext.getViewer().nsid,i=t.appContext.getViewer().signedIn,m=[this.appContext.getModelRegistry(this.modelConfig.commentModelRegistryName).then(function(e){t.commentModelRegistry=e}),this.appContext.getModel(this.modelConfig.listRegistryName,{id:this.modelConfig.modelId}).then(function(e){t.listModel=e})];switch(this.modelConfig.listRegistryName){case"gallery-info-models":m.push(this.appContext.getModel(this.modelConfig.listRegistryName,{id:this.modelConfig.modelId}).then(function(e){t.isSubjectOwner=i&&o===e.getValue("owner").getValue("nsid")}));break;case"photo-comments-models":m.push(this.appContext.getModel("photo-models",this.modelConfig.modelId).then(function(e){t.isSubjectOwner=o===e.getValue("owner").getValue("nsid")})),m.push(this.appContext.getModel("photo-engagement-models",this.params.photoId).then(function(e){t.engagementModel=e}))}return e.Promise.all(m).then(function(e){var n=t.listModel.getValue(t.modelConfig.collectionName).getList();return t.commentsPage=Math.ceil(n.length/t.perPage),"-1"===t.listModel.getValue(t.modelConfig.listRegistryContinuationName)&&(t.endOfComments=!0),0!==n.length?t.updateComments(n):t.getComments()}).then(function(){var e=t.get("container").all("img.notsowide"),n=e._nodes.length,o=0;0===n?t.handleLoadCommentsComplete():e.on(["load","error"],function(e){++o===n&&t.handleLoadCommentsComplete()})}).catch(function(e){n.error("Error getting info",{err:e})})},getComments:function(){var t,o=this;return this.endOfComments?e.Promise.resolve():(this.isFetchingComments=!0,"gallery"===this.modelConfig.type?t=this.getGalleryComments():"photo"===this.modelConfig.type&&(t=this.getPhotoComments()),t.then(function(){o.isFetchingComments=!1}).catch(function(e){n.error("Error getting comments",{err:e}),o.isFetchingComments=!1}))},getGalleryComments:function(){var e=this,t=this.notFirstPage?this.perPage:this.firstPerPage,n=this.listModel.getValue(e.modelConfig.collectionName).getList(),o=this.renderedCommentModels.length,i=[];if(n.length>o+t){for(var m=o;m<o+t;m++)i.push(n[m]);return e.updateComments(i)}return this.listModel.getCommentsByContinuation(t).then(function(t){return e.notFirstPage=!0,"-1"===e.listModel.getValue(e.modelConfig.listRegistryContinuationName)&&(e.endOfComments=!0),e.updateComments(t)})},getPhotoComments:function(){var t=this;return 0===this.engagementModel.getValue("commentCount")?(this.endOfComments=!0,e.Promise.resolve()):this.listModel.getValue(this.modelConfig.collectionName).getRange({offset:this.listModel.getValue(this.modelConfig.collectionName).getList().length,limit:this.perPage}).then(function(e){return t.commentsPage++,e.length<16&&(t.endOfComments=!0),t.updateComments(e)})},getMoreComments:function(){var t=this;return this.endOfComments?e.Promise.resolve():(this.showCommentLoading(!0),this.getComments().then(function(){t.showCommentLoading(!1)}))},showBalls:function(t){this.balls||(this.balls=e.Node.create('<li class="loading-balls"></li>'),this.balls.setHTML(this.templates("flickr-balls")({}))),t?(this.balls.addClass("bottom"),this.commentsListNode.append(this.balls)):this.commentsListNode.prepend(this.balls)},hideBalls:function(){this.balls&&(this.balls.removeClass("bottom"),this.balls.remove())},appendNewComment:function(t){var n=this,o=Object.assign(t.toJSON(),{appContext:this.appContext}),i=new e.Views["comment-item-view"](o);i.initialize(o).then(function(){i.activate()}).then(function(){var t=e.Node.create('<li class="comment-list-item"></li>');t.append(i.get("container")),n.commentsListNode.append(t),n.showCommentAddLoading(!1)}).then(function(){n.handleCommentViewAppended(i)})},handleCommentActionClick:function(e){var t=e.target,n=t.ancestor(".comment-item"),o=n.getAttribute("data-id");t.ancestor(".comment-action-menu-button",!0)&&this.showCommentActionMenu(o,n,t.ancestor(".comment-action-menu-button",!0).getAttribute("data-menutype")),t.ancestor(".comment-action-reply-button",!0)&&(e.preventDefault(),this.fire("subviewViewEvent",{eventName:"replyClicked",pathAliasOrNSID:t.ancestor(".comment-action-reply-button",!0).getAttribute("data-pathalias")}))},showCommentActionMenu:function(t,n,o){var i=this,m=[{text:this.intlMessage({intlName:"common.DELETE"}),value:"delete-comment-action"}];"owner"===o&&m.push({text:this.intlMessage({intlName:"common.EDIT"}),value:"edit-comment-action"}),n.addClass("active"),this.commentActionMenu||(this.commentActionMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnActionClick:!0,showDropArrow:!0,anchorElement:n.one(".comment-action-menu-button"),anchorOffsetHorizontal:11,classList:"over-modal comment-action-menu",overlayClassList:"over-modal",menuItems:m}),this.commentActionMenu.show(),this.registerEventHandler(this.commentActionMenu.on("closeDroparound",function(e){n.removeClass("active"),i.commentActionMenu=null})),this.registerEventHandler(this.commentActionMenu.on("selected",function(e){i.commentActionMenu.close(),"delete-comment-action"===e.menuItem.value?i.deleteComment(t,n):"edit-comment-action"===e.menuItem.value&&i.showEditComment(t,n)})))},deleteComment:function(e,t){return t.ancestor("li").remove(),this.deleteCommentCall(e)},deleteCommentCall:function(e){return"gallery"===this.modelConfig.type?this.deleteGalleryComment(e):"photo"===this.modelConfig.type?this.deletePhotoComment(e):void 0},showEditComment:function(e,t){var o=this,i=t.one(".content-container"),m=i.one(".comment-content");if(!this.isEditingComment)return this.isEditingComment=!0,this.commentModelRegistry.get(e).then(function(t){var s,l=m.get("offsetHeight");m.hide(),i.append(o.templates("comment-edit")({content:t.getValue("contentRaw")})),o.editCommentNode=i.one(".comment-edit"),(s=o.editCommentNode.one(".edit-field")).setStyle("height",Math.min(Math.max(l,100),200)),s.select(),o.registerEventHandler(o.editCommentNode.one(".cancel-edit-button").on("click",function(){m.show(),o.editCommentNode.remove(),o.isEditingComment=!1})),o.registerEventHandler(o.editCommentNode.one(".submit-edit-button").on("click",function(){o.updateComment(e,s.get("value"),m).then(function(e){m.set("innerHTML",e.getValue("contentSecure")),m.show(),o.editCommentNode.remove(),o.isEditingComment=!1}).catch(function(e){n.error("Error editing comment",{err:e}),m.show(),o.editCommentNode.remove(),o.isEditingComment=!1})}))})},updateComment:function(e,t){return this.updateCommentCall(e,t)},updateCommentCall:function(e,t){return"gallery"===this.modelConfig.type?this.updateGalleryComment(e,t):"photo"===this.modelConfig.type?this.updatePhotoComment(e,t):void 0},deleteGalleryComment:function(e){return this.commentModelRegistry.deleteRemote(e)},deletePhotoComment:function(e){var t=this;return this.commentModelRegistry.remoteDelete(e).then(function(){t.fire("subviewViewEvent",{eventName:"commentDeleted",commentModelId:e})})},updateGalleryComment:function(e,t){return this.commentModelRegistry.updateRemote(e,t)},updatePhotoComment:function(e,t){var n=this;return this.commentModelRegistry.get(e).then(function(o){return o.setValue("content",t),n.commentModelRegistry.remoteUpdate(e)})},delayPromise:function(t,n){return new e.Promise(function(e){setTimeout(function(){return e(n())},t)})},setLoading:function(e){this.isLoading=e},updateComments:function(e){},handleCommentViewAppended:function(){},showCommentLoading:function(){},showCommentAddLoading:function(){}})},"@VERSION@",{requires:["flickr-view","comment-item-view"],langBundles:["gallery","stats","comments","common"]});YUI.add("hermes-template-scrollable-comment-list-view",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,t,l){var n=null!=a?a:{},i=s.helperMissing,m=e.escapeExpression;return'<div class="comment-list-container loading">\n\t<ol class="comment-list">\n\t</ol>\n\t<div class="loading-text">'+m((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:"comments.LOADING_COMMENTS"},data:l}))+'</div>\n\t<div class="no-comments-text">'+m((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:"comments.NO_COMMENTS"},data:l}))+"</div>\n</div>"},useData:!0}),t={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(t[a]=s)}),e.Template.register("hermes/scrollable-comment-list-view",function(a,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,s(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("scrollable-comment-list-view",function(t,e){var s=require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create(this.name,t.Views["comment-list-view"],[],{langBundles:this.details.langBundles,initializer:function(t){this.constructor.superclass.initializer.call(this,t),this.listRegistryName=t.commentListConfig.listRegistryName,this.listId=t.commentListConfig.modelId},loadState:function(){var t=this;return t.appContext.getModel(t.listRegistryName,{id:t.listId}).then(function(e){t.commentListModel=e}).catch(function(t){throw s.error("Error getting comment list info",{err:t}),t})},buildContainer:function(){this.setContainerWithTemplate("scrollable-comment-list-view",this.params)},activate:function(){var t=this.get("container");this.listContainerNode=t.one(".comment-list-container"),this.scrollableEl=this.listContainerNode.getDOMNode(),this.registerEventHandler(this.commentListModel.on("valuesChanged",this.handleCommentListChange.bind(this),!0)),this.constructor.superclass.activate.call(this)},handleCommentListChange:function(t){0===t.comments.newVal.getList().length?this.showNoCommentsMessage():this.listContainerNode.removeClass("no-comments")},showNoCommentsMessage:function(){var t=this;this.listContainerNode.addClass("no-comments"),setTimeout(function(){t.fire("subviewViewEvent",{eventName:"emptyCommentContainer"})},300)},getNumOfComments:function(){return this.commentListModel.getValue(this.params.commentListConfig.collectionName).getList().length},setLoading:function(t){this.isLoading=t,this.listContainerNode.toggleClass("loading",t)},handleLoadCommentsComplete:function(){this.listContainerNode.removeClass("loading"),0===this.getNumOfComments()&&this.showNoCommentsMessage(),this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight,this.registerEventHandler(this.listContainerNode.on("scroll",this.handleCommentsScroll.bind(this)))},appendNewComment:function(t){0===this.getNumOfComments()&&this.listContainerNode.removeClass("no-comments"),this.constructor.superclass.appendNewComment.call(this,t)},handleCommentsScroll:function(t){!this.isFetchingComments&&this.scrollableEl.scrollTop<=0&&this.getMoreComments()},showCommentLoading:function(t){t?this.showBalls(!1):this.hideBalls()},showCommentAddLoading:function(t){t?(this.showBalls(!0),this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight):this.hideBalls()},handleCommentViewAppended:function(t){this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight},updateComments:function(t){var e=this;return t.forEach(function(t){e.renderedCommentModels.push(t)}),this.prependComments(t)},prependComments:function(e){var s=this,i=[],n=[];return e.forEach(function(e){var o=e.toJSON(),l=Object.assign(o,{appContext:this.appContext});l.isSubjectOwner=s.isSubjectOwner;var a=new t.Views["comment-item-view"](l),m=a.initialize(l).then(function(){a.activate()});n.push(a),i.push(m)}),t.Promise.all(i).then(function(){s.prependCommentViewsToDom(n)})},prependCommentViewsToDom:function(e){var s,i=this,n=this.scrollableEl,o=n.scrollHeight,l=n.scrollTop;e.forEach(function(e){(s=t.Node.create('<li class="comment-list-item"></li>')).append(e.get("container")),i.commentsListNode.prepend(s)}),n.scrollTop=n.scrollHeight-o+l}})},"@VERSION@",{requires:["flickr-view","comment-list-view","hermes-template-scrollable-comment-list-view"],langBundles:["common","comments"]});YUI.add("hermes-template-photo-comments-view",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,s){var l=null!=t?t:{},o=a.helperMissing,i=e.escapeExpression;return'<section class="comments-list-section">\n\t'+i((a.outlet||t&&t.outlet||o).call(l,null!=t?t["scrollable-comment-list-view"]:t,{name:"outlet",hash:{},data:s}))+'\n</section>\n\n<section class="add-comment-section">\n\t'+i((a.outlet||t&&t.outlet||o).call(l,null!=t?t["add-comment-view"]:t,{name:"outlet",hash:{},data:s}))+"\n</section>\n"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/photo-comments-view",function(t,s){return s=s||{},s.partials=s.partials?e.merge(n,s.partials):n,a(t,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-comment-edit",function(t,e){var n=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,e,n,a,s){var i,l=null!=e?e:{},m=n.helperMissing,o=t.escapeExpression;return'<div class="comment-edit">\n\t<textarea class="edit-field">'+o("function"==typeof(i=null!=(i=n.content||(null!=e?e.content:e))?i:m)?i.call(l,{name:"content",hash:{},data:s}):i)+'</textarea>\n\t<div class="buttons edit-comment-buttons">\n\t\t<button type="button" class="mini alt cancel-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:s}))+'</button>\n\t\t<button type="button" class="mini action submit-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.DONE"},data:s}))+"</button>\n\t</div>\n</div>"},useData:!0}),a={};t.Array.each([],function(e){var n=t.Template.get("hermes/"+e);n&&(a[e]=n)}),t.Template.register("hermes/comment-edit",function(e,s){return s=s||{},s.partials=s.partials?t.merge(a,s.partials):a,n(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-comments-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.params.commentListConfig={type:"photo",listRegistryName:"photo-comments-models",modelId:e.photoId,collectionName:"comments",commentModelRegistryName:"comment-models"},this.params.addCommentConfig={type:"photo",commentModelRegistryName:"comment-models",addCommentText:e.addCommentText||this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:"photo"})},this.commentsPage=0,this.signedIn=this.appContext.getViewer().signedIn},subviewConfig:{"scrollable-comment-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"add-comment-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){var t=this,o=[this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelRegistry=e}),this.appContext.getModel("photo-engagement-models",this.params.photoId).then(function(e){this.engagementModel=e}.bind(this)),this.appContext.getModel(this.params.commentListConfig.listRegistryName,this.params.commentListConfig.modelId).then(function(e){t.listModel=e})];return this.signedIn&&o.push(this.appContext.getModel("person-models",{id:this.appContext.getViewer().nsid}).then(function(e){t.userModel=e})),e.Promise.all(o)},buildContainer:function(){this.setContainerWithTemplate("photo-comments-view",{user:this.signedIn?this.userModel.toJSON():null,signedIn:this.signedIn})},activate:function(){this.get("container");this.commentListView=this.subviews["scrollable-comment-list-view"],this.addCommentView=this.subviews["add-comment-view"]},delayPromise:function(t,o){return new e.Promise(function(e){setTimeout(function(){return e(o())},t)})},onSubviewEvent:function(t,o){var n;if(o&&o[0])switch((n=o[0]).eventName){case"replyClicked":this.addCommentView.addReplyMessage(n.pathAliasOrNSID,!1);break;case"emptyCommentContainer":this.addCommentView.focusCommentBox();break;case"commentAddLoading":e.rapidTracker.beacon(this.name,"galleryPhotoCommentAddClick"),this.commentListView.showCommentAddLoading(n.isLoading);break;case"commentAdded":this.commentListView.appendNewComment(n.commentModel),this.listModel.getValue(this.params.commentListConfig.collectionName).prependToList(n.commentModel),this.engagementModel.setValue("commentCount",this.engagementModel.getValue("commentCount")+1);break;case"commentDeleted":this.listModel.getValue(this.params.commentListConfig.collectionName).removeFromList(n.commentModelId),this.engagementModel.setValue("commentCount",this.engagementModel.getValue("commentCount")-1)}}})},"@VERSION@",{requires:["flickr-view","comment-item-view","add-comment-view","scrollable-comment-list-view","hermes-template-photo-comments-view","hermes-template-comment-edit"],langBundles:["gallery","stats","comments","common"]});YUI.add("hermes-template-add-to-stuff-view",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item album-tab selected" data-tab="album" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.ALBUMS"},data:l}))+"</span>\n\t\t\t\t</li>\n"},3:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item gallery-tab" data-tab="gallery" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:l}))+"</span>\n\t\t\t\t</li>\n"},5:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item group-tab" data-tab="group" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GROUPS"},data:l}))+"</span>\n\t\t\t\t</li>\n"},7:function(t,a,e,n,l){var s=null!=a?a:{},i=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="tab-container selected" data-tab="album">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["album-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["album-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t</div>\n"},9:function(t,a,e,n,l){var s=null!=a?a:{},i=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="tab-container" data-tab="gallery">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["gallery-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["gallery-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t</div>\n"},11:function(t,a,e,n,l){var s,i=null!=a?a:{};return'\t\t\t<div class="tab-container" data-tab="group">\n\t\t\t\t'+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(i,null!=a?a["group-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"+(null!=(s=e.if.call(i,null!=a?a.inlineGroupCreation:a,{name:"if",hash:{},fn:t.program(12,l,0),inverse:t.noop,data:l}))?s:"")+"\t\t\t</div>\n"},12:function(t,a,e,n,l){return"\t\t\t\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["group-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"},compiler:[7,">= 4.0.0"],main:function(t,a,e,n,l){var s,i=null!=a?a:{};return'<div class="add-to-stuff-container" tabindex="-1">\n\t<div class="nav">\n\t\t<div class="list-label">'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"add-to-stuff.ADD_TO_LABEL"},data:l}))+"</div>\n\t\t<ul>\n"+(null!=(s=e.if.call(i,null!=a?a.showAlbums:a,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=a?a.showGalleries:a,{name:"if",hash:{},fn:t.program(3,l,0),inverse:t.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=a?a.showGroups:a,{name:"if",hash:{},fn:t.program(5,l,0),inverse:t.noop,data:l}))?s:"")+'\t\t</ul>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</div>\n\t<div class="tab-content-container">\n\n'+(null!=(s=e.if.call(i,null!=a?a.showAlbums:a,{name:"if",hash:{},fn:t.program(7,l,0),inverse:t.noop,data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=a?a.showGalleries:a,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.noop,data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=a?a.showGroups:a,{name:"if",hash:{},fn:t.program(11,l,0),inverse:t.noop,data:l}))?s:"")+"\t</div>\n</div>\n"},useData:!0}),n={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)}),t.Template.register("hermes/add-to-stuff-view",function(a,l){return l=l||{},l.partials=l.partials?t.merge(n,l.partials):n,e(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("add-to-stuff-view",function(e){e.namespace("Views")[this.name]=e.Base.create("add-to-stuff-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.params.showAlbums=!1!==this.params.showAlbums,this.params.showGalleries=!1!==this.params.showGalleries,this.params.showGroups=!1!==this.params.showGroups,this.params.initialTab=this.params.initialTab||"album",this.initialTab=this.params.initialTab,this.params.inlineGroupCreation=this.params.inlineGroupCreation||!1,this.currentTabName="",this},subviewConfig:{"album-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"gallery-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"group-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"album-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]},"gallery-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]},"group-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]}},buildContainer:function(){return this.setContainerWithTemplate("add-to-stuff-view",{showAlbums:this.params.showAlbums,showGalleries:this.params.showGalleries,showGroups:this.params.showGroups,inlineGroupCreation:this.params.inlineGroupCreation}),this},activate:function(){var t=this.get("container");return this.nav=t.one(".nav"),this.doneButton=t.one(".done-button"),this.createButton=t.one(".create-button"),this.firstTab=t.one(".tab-item"),this.registerEventHandler(this.nav.one("ul").on(["click","key"],this.handleNavClick.bind(this),"down:13")),this.registerEventHandler(this.nav.one(".close-x-button").on("click",this.handleCloseClick.bind(this))),this.registerEventHandler(e.on("addToStuff:hideNav",function(e){this.nav.hide()}.bind(this))),this.registerEventHandler(e.on("addToStuff:showNav",function(e){this.nav.show()}.bind(this))),this.registerEventHandler(e.on("addToStuff:showCreate",function(t){e.one("."+t.type+"-selection-view").addClass("hidden"),e.one("."+t.type+"-creation-view").removeClass("hidden"),this.nav.hide(),e.fire("addToStuff:createShown",{curationType:this.currentTabName}),e.fire("addToStuff:reposition")}.bind(this))),this.registerEventHandler(e.on("addToStuff:hideCreate",function(t){e.one("."+t.type+"-selection-view").removeClass("hidden"),e.one("."+t.type+"-creation-view").addClass("hidden"),this.nav.show(),e.fire("addToStuff:createHidden",{curationType:this.currentTabName}),e.fire("addToStuff:reposition")}.bind(this))),this.switchTabs(this.initialTab),this.registerEventHandler(t.on("keydown",this.handleKeyPress.bind(this))),this.registerEventHandler(t.delegate("focus",this.handleFocus.bind(this))),this},handleNavClick:function(e){var t;e.stopPropagation(),e.preventDefault(),e.target&&(t=e.target.ancestor("li",!0))&&this.switchTabs(t.get("dataset").tab)},switchTabs:function(t){var i=this.nav.one(".tab-item.selected"),n=this.nav.one(".tab-item[data-tab="+t+"]"),a=i?i.get("dataset").tab:null,r=this.get("container").one(".tab-content-container"),s=r.one(".tab-container[data-tab="+a+"]"),o=r.one(".tab-container[data-tab="+t+"]"),l=o.one(".stuff-selection-search");this.currentTabName=t,i&&(i.removeClass("selected"),s.removeClass("selected")),n.addClass("selected"),o.addClass("selected"),setTimeout(function(){l.focus()},0),e.fire("addToStuff:reposition")},handleCloseClick:function(t){e.fire("addToStuff:close")},handleKeyPress:function(t){var i=t.keyCode,n=t.shiftKey,a=this.doneButton||this.createButton;9===i&&(n&&this.focusedItem===this.firstTab?(t.preventDefault(),a.focus()):n||this.focusedItem!==a||(t.preventDefault(),this.firstTab.focus())),e.fire("addToStuff:keyPressed",{curationType:this.currentTabName,evt:t})},handleFocus:function(e){this.focusedItem=e.target}},{ATTRS:{dismissOnCreate:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateAlbum:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateGallery:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateGroup:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelect:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectAlbum:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectGallery:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectGroup:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},inlineGroupCreation:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},useLargeLayout:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-add-to-stuff-view"],langBundles:["common","more-menu-view","add-to-stuff"]});YUI.add("hermes-lang-more-menu-view",function(e,o){e.Intl.add("hermes/more-menu-view","en-US",{ADD_TO_ALBUM:["Add to album"],ADD_TO_SET:["Add to set"],ADD_TO_GROUP:["Add to group"],INVITE_TO_GROUP:["Invite to group"],ADD_TO_GALLERY:["Add to Gallery"],ADD_TO_REMOVE_FROM_ALBUM:["Add to / remove from album"],ADD_TO_REMOVE_FROM_SET:["Add to / remove from set"],ADD_TO_REMOVE_FROM_GALLERY:["Add to / remove from gallery"],ADD_TO_REMOVE_FROM_GROUP:["Add to / remove from group"],INVITE_TO_REMOVE_FROM_GROUP:["Invite to / remove from group"],FLAG_PHOTO:["Flag this Photo?"],FLAG:["Flag photo"],MARK_FOR_REVIEW:["Mark for review"],PHOTO_HAS_BEEN_FLAGGED:["This photo has been flagged"],PROBLEM_FLAGGING:["There was a problem flagging this photo"],ADD_PHOTO_TO_GROUP:["Add this photo to a group"],INVITE_PHOTO_TO_GROUP:["Invite this photo to a group"],ADD_PHOTO_TO_GALLERY:["Add this photo to a gallery"],ADD_PHOTO_TO_ALBUM:["Add photo to an album"],ADD_PHOTO_TO_SET:["Add photo to a set"],NO_GROUPS:["You're not in any groups! <a href='//www.flickr.com/groups'>Why not join one</a>?"],NO_GROUPS2:["You're not in any groups! <a href='","${url}","'>Why not join one</a>?"],NO_GROUPS_ADMIN:["You're not an admin of any groups! <a href='//www.flickr.com/groups_create.gne'>Why not create one</a>?"],NO_GROUPS_ADMIN2:["You're not an admin of any groups! <a href='","${url}","'>Why not create one</a>?"],NO_GALLERIES:["No galleries"],NO_ALBUMS:["No albums"],NO_SETS:["No sets"],LOADING_GROUPS:["Loading groups..."],LOADING_GALLERIES:["Loading galleries..."],LOADING_ALBUMS:["Loading albums..."],LOADING_SETS:["Loading sets..."],SEARCH_GROUPS_PLACEHOLDER:["search groups"],SEARCH_GALLERIES_PLACEHOLDER:["search galleries"],SEARCH_ALBUMS_PLACEHOLDER:["search albums"],SEARCH_SETS_PLACEHOLDER:["search sets"],GALLERY_TITLE_PLACEHOLDER:["gallery title (required)"],GALLERY_DESCRIPTION_PLACEHOLDER:["gallery description"],ALBUM_TITLE_PLACEHOLDER:["Album title"],SET_TITLE_PLACEHOLDER:["Set title"],DESCRIPTION_PLACEHOLDER:["Description (optional)"],CREATE_NEW_GALLERY:["Create a new gallery"],CREATE_NEW_ALBUM:["Create new album"],CREATE_NEW_SET:["Create new set"],CREATE_GALLERY:["Create gallery"],CREATE_SET:["Create set"],CREATE_ALBUM:["Create album"],BACK_TO_GALLERIES:["Back to current galleries"],BACK_TO_ALBUMS:["Back to current albums"],BACK_TO_SETS:["Back to current sets"],GROUP_PRIVACY_WARNING:["This photo is private. If you add it to a group, the members of that group will be able to view, comment on, tag and add notes to it."],DONT_SHOW_ME_AGAIN:["Don't show me this message again"],DELETE_PHOTO:["Delete Photo"],PERMANENTLY_DELETE_PHOTO:["Permanently Delete This Photo"],PROBLEM_DELETING:["There was a problem deleting this photo"],ADD_LOCATION:["Add Location"],ADD_PEOPLE:["Add people"],DOWNLOAD_ALL_SIZES:["Download / All sizes"],EDIT_DATES:["Edit dates"],EDIT_TITLE_TAGS_DATES:["Edit title, tags, and dates"],ROTATE:["Rotate"],REPLACE:["Replace"],VIDEOS_NO_EDIT_IN_AVIARY:["Videos cannot be edited in Aviary"],EDIT_IN_AVIARY:["Edit in Aviary"],COMMENTING:["Commenting"],REPORT_ABUSE:["Report abuse"],FEEDBACK:["Feedback"],PEOPLE_TAGGING:["People tagging!"],OPEN_IN_ORGANIZER:["Open In Organizr"],MORE_ACTIONS:["More Actions"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-lang-add-to-stuff",function(e,o){e.Intl.add("hermes/add-to-stuff","en-US",{ADD_TO_LABEL:["Add to:"],NO_RESULTS:["No results :("],NO_GROUPS:["No groups"],DONT_ADMIN_ANY_GROUPS:["You don’t admin any groups."],LEARN_TO_RUN_GROUP:["Learn how to run a group"],HAVENT_JOINED_ANY_GROUPS:["You haven’t joined any groups."],DISCOVER_GROUPS:["Discover groups"],PENDING_APPROVAL:["Pending approval"],CURATIONS_CREATE_NEW_GROUP:["Create new group"],CURATIONS_CREATE_A_NEW_GROUP:["Create a new group"],CURATIONS_CREATE_NEW_ALBUM:["Create new album"],CURATIONS_CREATE_A_NEW_ALBUM:["Create a new album"],CURATIONS_CREATE_NEW_GALLERY:["Create new gallery"],CURATIONS_CREATE_A_NEW_GALLERY:["Create a new gallery"],ABOUT_YOUR_GROUP:["About your group"],COULDNT_ADD_TO_GROUP:["Couldn’t add to group."],COULDNT_ACCEPT_GROUP_INVITE:["Couldn’t accept invitation to group."],COULDNT_INVITE_TO_GROUP:["Couldn’t invite to group."],COULDNT_CANCEL_GROUP_INVITE:["Couldn’t cancel group invitation."],COULDNT_REMOVE_FROM_GROUP:["Couldn’t remove from group"],APPROVE:["Approve"],CURATIONS_ALBUM_NAME:["Album name"],CURATIONS_GALLERY_NAME:["Gallery name"],CURATIONS_DESCRIPTION_OPTIONAL:["Description (optional)"],PLEASE_ENTER_GROUP_NAME:["Please enter a group name."],PLEASE_ENTER_ALBUM_NAME:["Please enter an album name."],PLEASE_ENTER_GALLERY_NAME:["Please enter a gallery name."],COULDNT_SAVE_GROUP:["Couldn’t save group. Please try again."],COULDNT_SAVE_ALBUM:["Couldn’t save album. Please try again."],COULDNT_SAVE_GALLERY:["Couldn’t save gallery. Please try again."],GROUP_PRIVATE_PHOTO_WARNING:["This photo is private. If you add it to a group, the members of that group will be able to view, comment on, tag, and add notes to it."],CONFIRM_GROUP_PRIVATE_PHOTO_ADD:["Ok, add to groups anyway"],DONT_SHOW_MESSAGE_AGAIN:["Don’t show me this message again"],COULDNT_ADD_TO_GROUP_TOO_MANY:["Photo in maximum number of groups"],COULDNT_ADD_TO_GROUP_TOO_MANY_NON_PRO:["Photo in maximum number of groups for non-pro account"],YOU_ALREADY_ADDED_MAXIMUM_TO_GROUP:["You have already added the maximum number of photos to this group"],COULDNT_ADD_PHOTO:["Oh no! We couldn’t add the ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}},"."],ONLY_PUBLIC_PHOTOS_ALLOWED:["Oops! Only public ",{type:"select",valueName:"mediaType",options:{photo:["photos"],video:["videos"],other:["photos"]}}," are allowed."],GALLERY_FULL:["Oops! This gallery is full."],ONLY_SAFE_PHOTOS_ALLOWED:["Uh oh! Only ",{type:"select",valueName:"mediaType",options:{photo:["photos"],video:["videos"],other:["photos"]}}," marked “Safe” are allowed."],YOUVE_BEEN_BLOCKED:["You’ve been blocked by the photo owner."],OWNER_DOESNT_ALLOW_IN_GALLERIES:["Oh no! The ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}}," owner doesn’t allow their stuff in galleries."]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-template-infobar-photolist-photo",function(n,t){var l=n.Template.Handlebars.revive({1:function(n,t,l,a,e){return" info-bar-on-hover"},3:function(n,t,l,a,e){return" restricted-image"},5:function(n,t,l,a,e){return" is-video"},7:function(n,t,l,a,e){return" has-descriptions"},9:function(n,t,l,a,e){var o;return null!=(o=l.if.call(null!=t?t:{},null!=(o=null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.buddyicon:o)?o.default:o,{name:"if",hash:{},fn:n.program(10,e,0),inverse:n.program(12,e,0),data:e}))?o:""},10:function(n,t,l,a,e){var o,s=n.lambda,i=n.escapeExpression;return'\t\t\t<a class="avatar person tiny no-menu" style="background-image: url('+i(s(null!=(o=null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.buddyicon:o)?o.default:o,t))+');" href="/photos/'+i(s(null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.pathAlias:o,t))+'/"></a>\n'},12:function(n,t,l,a,e){var o,s=n.lambda,i=n.escapeExpression;return'\t\t\t<a class="avatar person tiny no-menu" style="background-image: url('+i(s(null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.buddyicon:o,t))+');" href="/photos/'+i(s(null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.pathAlias:o,t))+'/"></a>\n'},14:function(n,t,l,a,e){var o,s,i=null!=t?t:{},r=n.escapeExpression;return'\t\t\t\t<a href="'+r("function"==typeof(s=null!=(s=l.photoPageUrl||(null!=t?t.photoPageUrl:t))?s:l.helperMissing)?s.call(i,{name:"photoPageUrl",hash:{},data:e}):s)+'" class="title" title="'+(null!=(o=l.if.call(i,null!=(o=null!=t?t.photo:t)?o.title:o,{name:"if",hash:{},fn:n.program(15,e,0),inverse:n.program(17,e,0),data:e}))?o:"")+'" tabindex="-1">\n\t\t\t\t\t'+r(n.lambda(null!=(o=null!=t?t.photo:t)?o.title:o,t))+"\n\t\t\t\t</a>\n"},15:function(n,t,l,a,e){var o;return n.escapeExpression(n.lambda(null!=(o=null!=t?t.photo:t)?o.title:o,t))},17:function(n,t,l,a,e){return n.escapeExpression((l.intlMessage||t&&t.intlMessage||l.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{intlName:"common.UNTITLED"},data:e}))},19:function(n,t,l,a,e){var o;return'\t\t\t\t<a href="'+n.escapeExpression(n.lambda(null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.url:o,t))+'" class="attribution">\n'+(null!=(o=(l.photoAttribution||t&&t.photoAttribution||l.helperMissing).call(null!=t?t:{},null!=t?t.photo:t,null!=t?t.flippers:t,{name:"photoAttribution",hash:{},fn:n.program(20,e,0),inverse:n.noop,data:e}))?o:"")+"\t\t\t\t</a>\n"},20:function(n,t,l,a,e){var o;return null!=(o=l.if.call(null!=t?t:{},null!=t?t.intlName:t,{name:"if",hash:{},fn:n.program(21,e,0),inverse:n.program(23,e,0),data:e}))?o:""},21:function(n,t,l,a,e){return"\t\t\t\t\t\t\t"+n.escapeExpression((l.intlMessage||t&&t.intlMessage||l.helperMissing).call(null!=t?t:{},{name:"intlMessage",hash:{user:null!=t?t.user:t,intlName:null!=t?t.intlName:t},data:e}))+"\n"},23:function(n,t,l,a,e){var o;return"\t\t\t\t\t\t\t"+n.escapeExpression("function"==typeof(o=null!=(o=l.user||(null!=t?t.user:t))?o:l.helperMissing)?o.call(null!=t?t:{},{name:"user",hash:{},data:e}):o)+"\n"},25:function(n,t,l,a,e){return" faved"},27:function(n,t,l,a,e){return" can-not-fave"},29:function(n,t,l,a,e){return" hidden"},31:function(n,t,l,a,e){var o;return n.escapeExpression((l.formatNumber||t&&t.formatNumber||l.helperMissing).call(null!=t?t:{},null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.faveCount:o,{name:"formatNumber",hash:{},data:e}))},33:function(n,t,l,a,e){var o;return n.escapeExpression((l.formatNumber||t&&t.formatNumber||l.helperMissing).call(null!=t?t:{},null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.commentCount:o,{name:"formatNumber",hash:{},data:e}))},35:function(n,t,l,a,e){var o,s=null!=t?t:{};return'\t\t\t\t<span role="button" class="engagement-item views" tabindex="0">\n\t\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t\t<svg class="icon icon-view"><use xlink:href="#icon-view"></use></svg>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="engagement-count'+(null!=(o=l.if.call(s,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.viewCount:o,{name:"if",hash:{},fn:n.noop,inverse:n.program(29,e,0),data:e}))?o:"")+'">\n\t\t\t\t\t\t'+(null!=(o=l.if.call(s,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.viewCount:o,{name:"if",hash:{},fn:n.program(36,e,0),inverse:n.noop,data:e}))?o:"")+"\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n"},36:function(n,t,l,a,e){var o;return n.escapeExpression((l.formatNumber||t&&t.formatNumber||l.helperMissing).call(null!=t?t:{},null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.viewCount:o,{name:"formatNumber",hash:{},data:e}))},38:function(n,t,l,a,e){return'\t\t\t\t<span role="button" class="engagement-item curate" tabindex="0">\n\t\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t\t<svg class="icon icon-curate"><use xlink:href="#icon-curate"></use></svg>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n'},compiler:[7,">= 4.0.0"],main:function(n,t,l,a,e){var o,s,i=null!=t?t:{},r=n.escapeExpression;return'<div class="photo-list-photo-container'+(null!=(o=l.if.call(i,null!=t?t.infoBarOnHover:t,{name:"if",hash:{},fn:n.program(1,e,0),inverse:n.noop,data:e}))?o:"")+' loading">\n\t<div class="photo-container">\n\t\t<div class="photo'+(null!=(o=l.if.call(i,null!=(o=null!=t?t.photo:t)?o.needsInterstitial:o,{name:"if",hash:{},fn:n.program(3,e,0),inverse:n.noop,data:e}))?o:"")+(null!=(o=l.if.call(i,null!=(o=null!=t?t.photo:t)?o.isVideo:o,{name:"if",hash:{},fn:n.program(5,e,0),inverse:n.noop,data:e}))?o:"")+(null!=(o=l.if.call(i,null!=t?t.displayDescriptions:t,{name:"if",hash:{},fn:n.program(7,e,0),inverse:n.noop,data:e}))?o:"")+'"></div>\n\t\t<a class="click-target" href="'+r("function"==typeof(s=null!=(s=l.photoPageUrl||(null!=t?t.photoPageUrl:t))?s:l.helperMissing)?s.call(i,{name:"photoPageUrl",hash:{},data:e}):s)+'" tabindex="0" role="heading" aria-level="3" aria-label="'+r(n.lambda(null!=(o=null!=t?t.photo:t)?o.title:o,t))+'"></a>\n\t</div>\n\t\n\t<div class="sub-photo-info-bar invisible">\n\t\t<div class="details-container">\n'+(null!=(o=l.if.call(i,null!=t?t.showOwnerIcon:t,{name:"if",hash:{},fn:n.program(9,e,0),inverse:n.noop,data:e}))?o:"")+'\t\t\t<div class="details">\n'+(null!=(o=l.if.call(i,null!=(o=null!=t?t.photo:t)?o.title:o,{name:"if",hash:{},fn:n.program(14,e,0),inverse:n.noop,data:e}))?o:"")+"\n"+(null!=(o=l.if.call(i,null!=(o=null!=(o=null!=t?t.photo:t)?o.owner:o)?o.displayname:o,{name:"if",hash:{},fn:n.program(19,e,0),inverse:n.noop,data:e}))?o:"")+'\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="engagement">\n\t\t\t<span role="button" class="engagement-item fave '+(null!=(o=l.if.call(i,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.isFaved:o,{name:"if",hash:{},fn:n.program(25,e,0),inverse:n.noop,data:e}))?o:"")+(null!=(o=l.if.call(i,null!=t?t.canFave:t,{name:"if",hash:{},fn:n.noop,inverse:n.program(27,e,0),data:e}))?o:"")+'" tabindex="0">\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-fave_hollow"><use xlink:href="#icon-fave_hollow"></use></svg>\n\t\t\t\t\t<svg class="icon icon-fave filled"><use xlink:href="#icon-fave"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count'+(null!=(o=l.if.call(i,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.faveCount:o,{name:"if",hash:{},fn:n.noop,inverse:n.program(29,e,0),data:e}))?o:"")+'">\n\t\t\t\t\t'+(null!=(o=l.if.call(i,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.faveCount:o,{name:"if",hash:{},fn:n.program(31,e,0),inverse:n.noop,data:e}))?o:"")+'\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t\t<span role="button" class="engagement-item comment" tabindex="0">\n\t\t\t\t<span class="engagement-icon">\n\t\t\t\t\t<svg class="icon icon-comment_hollow"><use xlink:href="#icon-comment_hollow"></use></svg>\n\t\t\t\t</span>\n\t\t\t\t<span class="engagement-count'+(null!=(o=l.if.call(i,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.commentCount:o,{name:"if",hash:{},fn:n.noop,inverse:n.program(29,e,0),data:e}))?o:"")+'">\n\t\t\t\t\t'+(null!=(o=l.if.call(i,null!=(o=null!=(o=null!=t?t.photo:t)?o.engagement:o)?o.commentCount:o,{name:"if",hash:{},fn:n.program(33,e,0),inverse:n.noop,data:e}))?o:"")+"\n\t\t\t\t</span>\n\t\t\t</span>\n"+(null!=(o=l.if.call(i,null!=t?t.displayViews:t,{name:"if",hash:{},fn:n.program(35,e,0),inverse:n.noop,data:e}))?o:"")+(null!=(o=l.if.call(i,null!=t?t.displayCurate:t,{name:"if",hash:{},fn:n.program(38,e,0),inverse:n.noop,data:e}))?o:"")+"\t\t</div>\n\n\t</div>\n</div>\n"},useData:!0}),a={};n.Array.each([],function(t){var l=n.Template.get("hermes/"+t);l&&(a[t]=l)}),n.Template.register("hermes/infobar-photolist-photo",function(t,e){return e=e||{},e.partials=e.partials?n.merge(a,e.partials):a,l(t,e)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("infobar-photolist-photo-view",function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.PhotoListSubview,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.photoModel=e.model,this.signedIn=this.appContext.getViewer().signedIn,this.set("isActiveViewAgnostic",!0),this.hideCommentCount=e.hideCommentCount||!1,this.hideFaveCount=e.hideFaveCount||!1,this.params.displayCurate=void 0===this.params.displayCurate||this.params.displayCurate},loadState:function(){return e.Promise.all([this.appContext.getModel("photo-engagement-models",this.get("id")).then(function(e){this.engagementModel=e}.bind(this)),this.appContext.getModel("photo-models",this.get("id")).then(function(e){this.photoModel=e,this.get("model")||this.set("model",this.photoModel)}.bind(this))])},buildContainer:function(){var t,i=e.URLHelper.getPhotoPage({photoId:this.get("model").getValue("id"),pathAlias:this.get("model").getValue("owner").getValue("pathAlias"),contextSuffix:this.params.contextSuffix}),a=this.get("model"),n=a.getValue("owner"),o=a.getValue("engagement"),s={title:a.getValue("title"),isVideo:a.getValue("isVideo"),needsInterstitial:a.getValue("needsInterstitial"),mediaType:a.getValue("mediaType"),owner:{buddyicon:n.getValue("buddyicon"),pathAlias:n.getValue("pathAlias"),displayname:n.getValue("displayname"),url:n.getValue("url")},engagement:{isFaved:o.getValue("isFaved"),faveCount:this.hideFaveCount?0:o.getValue("faveCount"),commentCount:this.hideCommentCount?0:o.getValue("commentCount"),canFave:o.getValue("canFave"),viewCount:o.getValue("viewCount")}};this.get("container");t={photoPageUrl:i,photoUrl:this.get("photoUrl"),photo:s,infoBarOnHover:this.params.infoBarOnHover,showOwnerIcon:this.params.showOwnerIcon,canFave:this.signedIn&&s.engagement.canFave,displayViews:this.params.displayViews,displayCurate:this.params.displayCurate&&this.appContext.flipper.isFlipped("enable-megadroparound")&&this.signedIn},this.setContainerWithTemplate("infobar-photolist-photo",t),this.updateGeometry()},activate:function(){var t=this.get("container");this.mainContainer=t.one(".photo-list-photo-container"),this.photoContainer=t.one(".photo-container"),this.infoBar=t.one(".sub-photo-info-bar"),this.infoBarEngagement=this.infoBar.one(".engagement"),this.faveNode=this.infoBar.one(".engagement-item.fave"),this.commentNode=this.infoBar.one(".engagement-item.comment"),this.detailsNode=this.infoBar.one(".details-container"),this.avatar=this.detailsNode.one(".avatar"),this.appContext.flipper.isFlipped("enable-megadroparound")&&(this.curateNode=this.infoBar.one(".engagement-item.curate"),this.curateNode&&this.registerEventHandler(this.curateNode.on(["click","keydown"],this.handleCurateClick.bind(this)))),this.faveNode&&(this.faveCountNode=this.faveNode.one(".engagement-count")),this.faveNode&&this.registerEventHandler(this.faveNode.on(["click","key"],this.handleFaveClick.bind(this),"down:13")),this.commentNode&&(this.commentIcon=this.commentNode.one(".engagement-icon"),this.commentTextNode=this.commentNode.one(".engagement-count"),this.registerEventHandler(this.commentNode.on(["click","key"],this.handleCommentClick.bind(this),"down:13"))),this.registerEventHandler(this.engagementModel.on("valuesChanged",this.handleEngagementModelValuesChanged.bind(this))),this.downloadCacheAndSetImage(),e.UA.ie||this.appContext.getUA().isEdge?this.updateEdgeBreakpoints():(this.updateBreakpoints(),this.registerEventHandler(e.on("resize",e.betterThrottle(this.updateBreakpoints.bind(this),500,this,!0)))),this.mainContainer.removeClass("loading")},handleFaveClick:function(t){var a,n=t.currentTarget,o=n.one(".engagement-count");this.faveNode.hasClass("can-not-fave")?this.signedIn||this.showSignUpAndFaveModal(this.get("model").getValue("id"),e.config.win.location.href):this.isFaving||(this.isFaving=!0,this.engagementModel.toggleFave(),a=this.engagementModel.getValue("faveCount"),n.toggleClass("faved",this.engagementModel.getValue("isFaved")),o.toggleClass("empty",0===a),o&&a>0?o.set("text",a):o.set("text",""),this.engagementModel.remoteUpdate().then(function(){this.isFaving=!1}.bind(this),function(e){3!==e.code&&(this.engagementModel.toggleFave(),n.toggleClass("faved",this.engagementModel.getValue("isFaved")),o&&(o.set("text",a),o.toggleClass("empty",0===a))),i.error("Error faving photo",{err:e}),this.isFaving=!1}.bind(this)))},handleCommentClick:function(){var t,i=this,a=new e.Views["photo-comments-view"]({appContext:this.appContext,photoId:this.get("model").getValue("id"),isScrollable:!0,addCommentText:this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:this.get("model").getValue("mediaType")})});t=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,height:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,anchorOffsetHorizontal:12,classList:"infobar-photo-remark",anchorElement:this.commentIcon,keyboardAnchorElement:this.commentNode,subview:a,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),i.registerEventHandler(e.on("addComment:showingSignupModal",function(){t.close()})),t.on("closeDroparound",function(){i.commentNode.removeClass("active"),i.infoBar.removeClass("active")}),t.show(),this.commentNode.addClass("active"),this.infoBar.addClass("active")},handleCurateClick:function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(e.halt(),this.showAddToCuration())},showAddToCuration:function(){var t=this.get("model").getValue("isOwner"),i=new e.Views["add-to-stuff-view"]({photoId:this.get("id"),initialTab:t?"album":"gallery",showAlbums:t,showGalleries:!t,inlineGroupCreation:!1,dismissOnSelect:!0,dismissOnCreate:!0});this.curateDroparound=new e.Views.FluidDroparound({appContext:this.appContext,subview:i,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:400,newReposition:!0,autoSizeToContent:!0,anchorOffsetVertical:0,anchorOffsetHorizontal:12,anchorElement:this.curateNode,keyboardAnchorElement:this.curateNode,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1}),this.curateDroparound.show(),this.fire("curateOpened"),this.registerEventHandler(e.on("addToStuff:close",function(e){this.curateDroparound.close(e)}.bind(this))),this.registerEventHandler(this.curateDroparound.on("closeDroparound",function(e){this.fire("curateClosed")}.bind(this)))},handleEngagementModelValuesChanged:function(t){var i;t.commentCount&&(i=t.commentCount.newVal,this.commentTextNode.set("text",e.IntlNumber.format(i,this.appContext.lang,1)),this.commentTextNode.toggleClass("hidden",0===i))},updateBreakpoints:function(){var e=0;this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.photoContainer.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.curateNode&&this.curateNode.removeClass("hidden"),this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.avatar&&this.avatar.removeClass("hidden"),this.removeButtonContainer&&this.removeButtonContainer.addClass("invisible"),this.avatar&&this.detailsNode.get("clientWidth")<80&&this.avatar.addClass("hidden"),this.detailsNode.get("clientWidth")<=10&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+16&&(this.commentNode.addClass("hidden"),this.curateNode?e=this.curateNode.get("clientWidth"):this.faveNode.addClass("last"),this.faveCountNode&&this.infoBar.get("clientWidth")<this.faveNode.get("clientWidth")+e+16&&this.faveCountNode.addClass("hidden"),this.curateNode&&this.infoBar.get("clientWidth")<this.infoBarEngagement.get("clientWidth")+e+16&&(this.curateNode.addClass("hidden"),this.faveNode.addClass("last"))),this.mainContainer.get("clientWidth")<48&&this.photoContainer.addClass("narrow"),this.infoBar.removeClass("invisible"),this.removeButtonContainer&&this.removeButtonContainer.removeClass("invisible")},updateEdgeBreakpoints:function(){this.cardWidth=this.get("layoutItem").geometry.width,this.infoBar.addClass("invisible"),this.infoBar.removeClass("narrow"),this.photoContainer.removeClass("narrow"),this.detailsNode.removeClass("hidden"),this.commentNode.removeClass("hidden"),this.faveNode&&(this.faveNode.removeClass("hidden"),this.faveNode.removeClass("last"),this.faveCountNode.removeClass("hidden")),this.avatar&&this.avatar.removeClass("hidden"),this.removeButtonContainer&&this.removeButtonContainer.addClass("invisible"),this.avatar&&this.cardWidth<236&&this.avatar.addClass("hidden"),this.cardWidth<=90&&(this.infoBar.addClass("narrow"),this.detailsNode.addClass("hidden")),this.cardWidth<156&&(this.commentNode.addClass("hidden"),this.curateNode||this.faveNode.addClass("last")),this.cardWidth<186&&(this.commentNode.addClass("hidden"),this.curateNode||this.faveNode.addClass("last"),this.faveCountNode&&this.cardWidth<116&&(this.faveCountNode.addClass("hidden"),this.faveNode.addClass("last"),this.curateNode&&this.curateNode.addClass("hidden"))),this.cardWidth<48&&this.photoContainer.addClass("narrow"),this.infoBar.removeClass("invisible"),this.removeButtonContainer&&this.removeButtonContainer.removeClass("invisible")},showSignUpAndFaveModal:function(t,i){var a,n=this.intlMessage({intlName:"fave-view.SIGN_IN_BEFORE_FAVE_TITLE"}),o=this.intlMessage({intlName:"fave-view.JOIN_FLICKR_AND_FAVE"});(a=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-fave",signUpTitle:n,signUpMessage:o,beaconPrefix:"fave"})).on("signUpClick",function(a){e.SigninHelper.signUpPendingFave({id:t},{postLoginUrl:i})}),a.on("signInClick",function(a){e.SigninHelper.addPendingFave({id:t},{postLoginUrl:i})}),a.show()},downloadCacheAndSetImage:function(){e.fluid.loadImage(this.get("photoUrl"),{timeout:1e3,retry:!0}).then(function(e){this.handleImageLoad(!0,e)}.bind(this),function(e){this.handleImageLoad(!1,e+"?retry="+Date.now())}.bind(this))},handleImageLoad:function(t,i){var a=this.get("container").one(".photo");a.setStyle("backgroundImage","url("+i+")"),t||a.setStyle("backgroundColor","#eee"),e.fluid.chill(function(){this.fire(t?"loaded":"loadError")},this),a=null}})},"@VERSION@",{requires:["photo-list-subview","photo-comments-view","add-to-stuff-view","hermes-template-infobar-photolist-photo"],langBundles:["common","fave-view","comments"]});YUI.add("hermes-lang-fave-view",function(e,t){e.Intl.add("hermes/fave-view","en-US",{COULDNT_FAVE:["We couldn't fave at this time"],SIGN_IN_TO_FAVE:["You must be signed in to fave. Please sign in now."],LOADING_FAVES:["Loading Faves..."],UNFAVE_PHOTO:["Unfave this photo"],FAVE_PHOTO:["Fave this photo"],WHO_FAVED:["Who faved this photo"],SIGN_IN_BEFORE_FAVE_TITLE:["You found a photo to fave!"],SIGN_IN_BEFORE_FAVE_MESSAGE:["That's great. Just sign in to fave it."],SIGN_IN_AND_FAVE:["Sign in and fave"],JOIN_FLICKR_AND_FAVE:["Join Flickr to add this photo to your favorites."]})},"@VERSION@",{requires:["intl"]});YUI.add("mega-limit-overlay-view",function(e,t){var i=require("hermes-core/analytics");e.namespace("Views")[this.name]=e.Base.create("mega-limit-overlay-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.dismissCookieName=e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name},loadState:function(){var t=this;return!this.appContext.getCookie(this.dismissCookieName)&&this.appContext.flipper.isFlipped("enable-mega-limit-overlay")&&"products-flickrpro-route"!==this.appContext.routeConfig.module&&this.appContext.getViewer().signedIn?this.appContext.getModel("person-profile-models",this.appContext.getViewer().nsid).then(function(e){t.profileModel=e}):e.Promise.resolve()},buildContainer:function(){this.setContainerWithTemplate("mega-limit-overlay")},activate:function(){var t=this,i=this.get("container"),o=this.getFetchParams();if(this.contentContainer=i.one(".mega-limit-overlay"),this.firstImageCard=this.contentContainer.one(".first-image-card"),this.messageContainer=this.contentContainer.one(".info-message-container"),this.profileModel&&e.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext))return e.Promise.all([this.appContext.getModel("person-models",this.appContext.getViewer().nsid).then(function(e){t.userModel=e}),e.ListFetchers["flickr-people-getPhotos"].run(o,this.appContext).then(function(e){e&&e.length&&(t.photoModel=e[0])})]).then(function(){return t.photoModel?t.renderImageCard():e.Promise.reject()}).then(function(){t.isLoaded=!0,t.fire("loaded"),t.show()})},resizeImage:function(e,t){var i,o,a,n=this.photoModel.getValue("oWidth")/this.photoModel.getValue("oHeight");e=e||500,t=t||430,i=this.contentContainer.get("clientHeight"),(a=(o=Math.min(t,i-70))*n)>e&&(o=(a=e)/n),this.firstImageCard.setStyle("height",o+70),this.firstImageCard.setStyle("width",a),this.photoCardView.updateGeometry({aspectRatio:n,geometry:{width:a,height:o+70,top:0,left:0},isAwake:!0}),this.photoCardView.updateBreakpoints()},renderImageCard:function(){var t=this;return this.photoCardView=new e.Views["infobar-photolist-photo-view"]({appContext:this.appContext,id:this.photoModel.getValue("id"),layoutItem:{aspectRatio:this.photoModel.getValue("oWidth")/this.photoModel.getValue("oHeight"),geometry:{width:this.photoModel.getValue("oWidth"),height:this.photoModel.getValue("oHeight"),top:0,left:0},isAwake:!0},displayViews:!0,displayCurate:!1}),this.photoCardView.initialize().then(function(){return t.firstImageCard.append(t.photoCardView.get("container")),t.photoCardView.activate()})},getFetchParams:function(){return{perPage:1,page:1,userId:this.appContext.getViewer().nsid,orderBy:"date-posted-asc"}},show:function(){var t,o=this,a=this.get("container"),n=Math.min(500,o.appContext.viewportData.getWidth()),s=e.config.flickr.account.photo_limit,r=e.UserLimitsHelper.getARRCount(this.profileModel);t=Math.max(r-s,0).toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),this.messageContainer.append(this.templates("mega-limit-overlay-message")({overLimitCountString:t,rulesUrl:"https://blog.flickr.net/en/2018/12/17/important-service-updates-and-dates-to-remember/",acceptUrl:"/account/upgrade/pro?select",username:this.userModel.getValue("username")})),this.acceptButton=this.contentContainer.one(".accept-button"),this.declineButton=this.contentContainer.one(".decline-button"),a.addClass("displayed"),setTimeout(function(){a.addClass("active"),e.one("body").addClass("locked-for-overlay-scroll")},50),o.resizeImage(n),o.registerEventHandler(e.globalEvents.subscribe("window:resize",e.betterThrottle(function(e){var t=Math.min(500,o.appContext.viewportData.getWidth());o.resizeImage(t)},20,null,!0))),o.registerEventHandler(this.acceptButton.on("click",function(e){o.handleAcceptClick(e)})),o.registerEventHandler(this.declineButton.on("click",function(e){o.handleDeclineClick(e)})),i&&i.tl(!0,"o","Photo Limit Takeover: Show")},hide:function(){var t=this.get("container");e.one("body").removeClass("locked-for-overlay-scroll"),t.removeClass("active"),setTimeout(function(){t.removeClass("displayed")},1e3)},handleAcceptClick:function(t){this.hide(),i&&i.tl(e.one(t.target).getDOMNode(),"o","Photo Limit Takeover: Accept",null,"navigate")},handleDeclineClick:function(t){var o=new Date;o.setTime(o.getTime()+36e10),this.appContext.setCookie({cookieName:this.dismissCookieName,cookieValue:1,expires:o,path:"/"}),this.appContext.setCookie({cookieName:e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,cookieValue:1,expires:o,path:"/"}),i&&i.tl(!0,"o","Photo Limit Takeover: Decline"),this.hide()}})},"@VERSION@",{requires:["flickr-view","hermes-template-mega-limit-overlay","hermes-template-mega-limit-overlay-message","person-public-profile-models","intl-number","user-limits-helper","string-helper","api-helper","infobar-photolist-photo-view"],langBundles:["common","upload-blocking"]});YUI.add("global-nav-view",function(e,t){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var i,n;if(void 0===t.enableBrowserUpgradeBanner&&(t.enableBrowserUpgradeBanner=!0),this.set("showBrowserUpgradeBanner",!1),YUI.Env.isServer&&t.enableBrowserUpgradeBanner){var o=this.appContext.request.headers["user-agent"],a=e.BrowserSupport.isUnsupportedBrowser(o),s=e.BrowserSupport.isBot(o),r=e.BrowserSupport.isSharingBot(o);!a||s||r||this.set("showBrowserUpgradeBanner",!0)}if(!YUI.Env.isServer){var l=e.StorageHelper.getItem("hasDismissedBrowserUpgradeBanner",!0);l&&"true"===l&&this.set("showBrowserUpgradeBanner",!1)}return""===this.get("container").get("innerHTML")&&this.setContainerHTML('<div class="global-nav-content"></div>'),this.appStateParams=t,this.themeClass=t.theme||"default-theme",i=this.appContext.getLocation(),n=t.modelParams&&t.modelParams.apiParams?t.modelParams.apiParams:i.href,this.searchUrl=new e.SearchUrl(n,this.appContext,t.searchType),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.appContext.flipper.isFlipped("enable-sign-up-interstitial-test")&&"en-us"===this.appContext.lang.toLowerCase()&&(this.signUpInterstitialTest=!0),!this.appContext.flipper.isFlipped("enable-sign-up-rail-test")||"en-us"!==this.appContext.lang.toLowerCase()||this.appContext.getViewer().signedIn||t.isSOHP||(this.signUpRailTest=!0),this.isSOHP=t.isSOHP,this.hideBanner=t.isSearchResults,this.isRefencingAnnouncementPage=t.isRefencingAnnouncementPage,t.featuredToastConfig={id:"upload-limit-warning-toast",showOnActivate:!1},this.uploadLimitDismissHours=48,this},subviewConfig:{"search-autosuggest-field-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,isSOHP:this.isSOHP},"account-menu-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"notifications-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("notifications-menu")}},"browser-upgrade-banner-view":{requiredToShowOnServer:!0,requiredToShowOnClient:!1,dealbreaker:!1,disabled:function(){return!this.get("showBrowserUpgradeBanner")}},"person-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!(this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"))}},"group-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!(this.appContext.flipper.isFlipped("enable-hover-account-menu")&&this.appContext.flipper.isFlipped("rebootify-group-discussions-list"))}},"signup-rail-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["collapsed"],disabled:function(e){return e.isMobile||!this.signUpRailTest}},"flickr-chat-center-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(e){return!this.appContext.flipper.isFlipped("flickr-chat")||!this.appContext.getViewer().signedIn}},"partner-account-banner-view":{requiredToShowOnServer:!1,requiredToShowOnClient:!1},"featured-toast-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"mega-limit-overlay-view":{requiredToShowOnServer:!1,requiredToShowOnClient:!1}},loadState:function(){var t=this,i=this.appContext.getViewer(),n=[];return i.signedIn?(n.push(this.appContext.getModel("person-models",i.nsid).then(function(e){t.set("viewer",e),t.elementStates=t.setElementStates(t.appStateParams)})),n.push(this.appContext.getModel("person-profile-models",i.nsid).then(function(e){t.profileModel=e}))):this.elementStates=this.setElementStates(this.appStateParams),e.Promise.all(n).then(function(){t.get("viewer");!YUI.Env.isServer&&t.appContext.flipper.isFlipped("enable-feedback-modal")&&"en-US"===t.appContext.lang&&!localStorage.getItem("feedbackModalSeen12_18")&&t.appContext.hasClientSideRouted()&&"photostream-route"!==this.appContext.routeConfig.module&&(t.meetsFeedbackCriteria=!0)})},buildContainer:function(){var t,i={},n=this.appContext.getViewer().signedIn;return this.get("viewer")&&(i=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),t={theme:this.themeClass,"show-browser-upgrade-banner":this.get("showBrowserUpgradeBanner"),showNotificationsMenu:!1,viewer:i,isSignedIn:n,elements:this.elementStates,isRefencingAnnouncementPage:this.isRefencingAnnouncementPage,showFeaturedToast:(this.appContext.flipper.isFlipped("enable-upload-limit-warning")||this.appContext.flipper.isFlipped("enable-upload-limit-messages"))&&this.appContext.getViewer().signedIn,showMobileNavDrawer:this.appContext.flipper.isFlipped("enable-mobile-nav-drawer")},this.appContext.flipper.isFlipped("notifications-menu")&&n&&(t["notifications-menu-view"]=this.subviews["notifications-menu-view"].get("container"),t.showNotificationsMenu=!0),this.setContainerWithTemplate("global-nav",t),this},activate:function(){var i,n,o=this,a=this.get("container");return n=["photo-page-ad-scrappy-view","sohp-view"],i=this.appContext.flapp.get("activeView").name,this.contentContainer=a.one(".global-nav"),a.one(".mobile-nav-toggle")&&(this.appContext.flipper.isFlipped("enable-mobile-nav-drawer")?(this.navDrawer=a.one(".mobile-nav-drawer"),this.navDrawerOverlay=a.one(".mobile-nav-drawer-overlay"),this.registerEventHandler(a.one(".mobile-nav-toggle").on("click",function(e){o.navDrawerShown?o.hideMobileNavDrawer():o.showMobileNavDrawer()})),this.registerEventHandler(this.navDrawer.delegate("click",this.handleDrawerItemClick.bind(this),".mobile-nav-menu-item"))):this.registerEventHandler(a.one(".mobile-nav-toggle").on("click",function(t){e.rapidTracker.beacon(o.name,"mobile-nav-toggle",{action:this.contentContainer.hasClass("menu-open")?"close":"open"}),this.contentContainer.toggleClass("menu-open")}.bind(this)))),a.one(".mobile-search-button")?(this.registerEventHandler(a.one(".mobile-search-button").on("click",function(t){e.rapidTracker.beacon(o.name,"mobile-nav-search");var i=o.get("container"),n=o.contentContainer;n.addClass("search-open"),n.hasClass("menu-open")&&n.removeClass("menu-open"),o.fire("parentViewEvent","focus-search-field"),i.one(".flickr-logo-container").addClass("hidden")}.bind(this))),this.registerEventHandler(e.on("add-context-to-search-field",function(e){o.contentContainer.addClass("search-open"),o.fire("parentViewEvent","focus-search-field")},this))):this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(t){var i=e.config.win.innerWidth<=700,n=i?this.appContext.viewportData.getWidth():0,s=i?46:0;i||(o.contentContainer.removeClass("search-open"),a.one(".flickr-logo-container").removeClass("hidden")),o.fire("parentViewEvent","resize-search-field",n-s)}.bind(this))),a.one(".mobile-search-close-button")&&this.registerEventHandler(a.one(".mobile-search-close-button").on("click",function(e){o.contentContainer.removeClass("search-open"),a.one(".flickr-logo-container").removeClass("hidden"),o.fire("parentViewEvent","clear-search-field")}.bind(this))),this.appContext.getViewer().signedIn||(this.signedOutTest&&a.one(".gn-upload .gn-title")&&this.registerEventHandler(a.one(".gn-upload .gn-title").on("click",this.signUpAndUpload.bind(this))),n.indexOf(i)<0&&!this.isMobile&&this.signUpInterstitialTest&&this.startInterstitialTimer()),e.AnchorRepositioner.addOffset(t,a),this.registerEventHandler(a.delegate("keydown",this.toggleSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(a.delegate("keydown",this.enterSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(a.on("keydown",this.goToSubmenuHeading.bind(this),"ul.gn-submenu")),this.registerEventHandler(a.delegate("keydown",this.keyboardNavigation.bind(this),"ul.nav-menu")),this.registerEventHandler(a.delegate("mouseup",this.toggleAriaExpanded.bind(this),"a[aria-haspopup=true]")),this.showFeedbackModal(),this.toastSubview=this.subviews["featured-toast-view"],this.toastSubview.isActivated?o.setupToast():this.toastSubview.on("activated",function(){o.setupToast()}),e.on("accountCard:overLimitLearnMoreClick",function(){o.setupToast(!0)}),this.appContext.flipper.isFlipped("enable-photo-prints")&&(this.registerEventHandler(a.one(".gn-create .prints-button").on("click",this.handlePrintClick.bind(this))),this.appContext.flipper.isFlipped("enable-mobile-nav-drawer")&&this.registerEventHandler(a.one(".mobile-nav-drawer .prints-button").on("click",this.handlePrintClick.bind(this)))),this.appContext.flipper.isFlipped("enable-outage-banner")&&!this.appContext.getCookie(e.config.flickr.outage.dismiss_outage_banner_cookie_name)?this.createOutageWarningBanner():this.createLoginMigrationBanner(),this},showFeedbackModal:function(){var t=this;if(this.meetsFeedbackCriteria){var i,n=this.templates("feedback-modal-view")({}),o=new e.Views.FluidModal({appContext:this.appContext,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,classList:"modal-restyle",width:560,htmlMessage:n}),a=[];return this.appContext.getViewer().signedIn&&(this.get("viewer").getValue("isPro")&&a.push(this.appContext.getModel("person-proStatus-models",t.get("viewer").id).then(function(e){t.proStatusModel=e})),a.push(this.appContext.getModel("person-profile-models",t.get("viewer").id).then(function(e){t.profileModel=e}))),e.Promise.all(a).then(function(){o.show(),o.on("activated",function(){i=o.get("container").one(".accept-button"),o.get("container").one(".cancel-button").on("click",function(e){o.close()}),i.on("click",function(e){var n,a,s,r,l="http://v2.decipherinc.com/survey/selfserve/2225/180900?list=1",p=t.appContext.getViewer().signedIn?"yes":"no";i.setAttribute("disabled"),t.appContext.getViewer().signedIn&&(n=t.get("viewer").getValue("isPro")?"pro":"free",s=t.get("viewer").getValue("dateCreated").year()),t.proStatusModel&&(r=1e3*t.proStatusModel.toJSON().firstStart-new Date("November 1, 2018").getTime()>0?"yes":"no"),t.profileModel&&(a=t.profileModel.getValue("photoCount")),n&&(l+="&account_type="+encodeURIComponent(n)),l+="&logged_in="+encodeURIComponent(p),a&&(l+="&number_of_photos="+encodeURIComponent(a)),s&&(l+="&start="+encodeURIComponent(s)),r&&(l+="&newp="+encodeURIComponent(r)),window.open(l,"_blank"),o.close()})}),o.on("close",function(){localStorage.setItem("feedbackModalSeen12_18",!0)})})}},clearKeyboardFocus:function(e){this.get("container").all(".has-keyboard-focus").removeClass("has-keyboard-focus"),this.get("container").all(".nav-menu a[aria-expanded=true]").setAttribute("aria-expanded","false")},toggleAriaExpanded:function(e){e.target.setAttribute("aria-expanded","false"===e.target.getAttribute("aria-expanded")?"true":"false")},enterSubmenu:function(e){if(40===e.keyCode){e.preventDefault();var t=e.target.next("ul");t&&t.hasClass("has-keyboard-focus")&&t.one(":first-child").one(":first-child").focus()}},toggleSubmenu:function(e){var t=e.keyCode;if(13===t||32===t){e.preventDefault();var i=e.target.next("ul");i&&(i.hasClass("has-keyboard-focus")?this.clearKeyboardFocus():(i.addClass("has-keyboard-focus"),e.target.setAttribute("aria-expanded","true")))}},goToSubmenuHeading:function(e,t){var i;(t||27===e.keyCode)&&(t||this.clearKeyboardFocus(),e.target.hasClass("gn-submenu")?i=e.target.previous("a"):e.target.ancestor("ul.gn-submenu")&&(i=e.target.ancestor("ul.gn-submenu").previous("a")),i&&i.focus())},keyboardNavigation:function(e){var t=e.keyCode,i=9===t&&e.shiftKey,n=9===t&&!e.shiftKey;e.target.hasClass("gn-title")?(i=(37===t||i)&&e.target.ancestor("li").previous("li"),n=(39===t||n)&&!!e.target.ancestor("li").next("li"),i?(this.clearKeyboardFocus(),this.focusOnPreviousItem(e)):!n||e.target.next("ul")&&e.target.next("ul").hasClass("has-keyboard-focus")||(this.clearKeyboardFocus(),this.focusOnNextItem(e))):38===t||i?this.focusOnPreviousItem(e):(40===t||n)&&this.focusOnNextItem(e)},focusOnPreviousItem:function(e){e.preventDefault();var t=e.target.ancestor("li").previous("li:not(.divider)");t?t.one(":first-child").focus():e.target.ancestor("ul.gn-submenu")&&this.goToSubmenuHeading(e,!0)},focusOnNextItem:function(e){e.preventDefault();var t=e.target.ancestor("li").next("li:not(.divider)");t&&t.one(":first-child").focus()},startInterstitialTimer:function(){var t,i=this,n=!1;(t=e.StorageHelper.getItem("signUpInterstitialSeen"))?(t=e.moment(t,"x"),e.moment().subtract(2,"days")>t&&(n=!0)):n=!0,n&&(this.signUpInterstitialTimer=setTimeout(function(){if(!e.OverlayManager.hasOverlay()&&e.config.win.innerWidth>700){new e.Views.SignUpInterstitial({appContext:i.appContext}).show(),e.StorageHelper.setItem("signUpInterstitialSeen",e.moment().format("x"))}},4e3))},signUpAndUpload:function(t){var i,n=e.url("/upload/"),o=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_TITLE"}),a=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_MESSAGE"});t.halt(),e.rapidTracker.beacon(this.name,"uploadButtonClick"),(i=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:o,signUpMessage:a,beaconPrefix:"upload"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("upload",{postLoginUrl:n})}),i.on("signInClick",function(t){e.SigninHelper._redirectToSignin("upload",{postLoginUrl:n})}),i.show()},executeSearch:function(e){var t,i=this.get("container").one("#gn-search-field").getDOMNode();t=this.searchUrl.createNewSearch(i.value).getURL(),e.halt(),this.appContext.flapp.navigate(t)},setElementStates:function(e){var t=this.appContext.getViewer(),i={you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,weekly_flickr:!1,create_link:!0,get_pro_link:!0,upload_icon:!1,account_menu:!1,search_bar:!1,signup_link:!1,signin_link:!1,right_side_signup:!1,vr_link:!0};return e.isSOHP&&!t.signedIn?(i.search_bar=!0,i.signin_link=!0,i.signup_link=!0,i.create_link=!1,i.get_pro_link=!1):t.signedIn?(i.you_menu=!0,i.explore_menu=!0,i.upload_icon=!0,i.search_bar=!0,i.account_menu=!0):(i.signup_link=!0,i.explore_menu=!0,i.upload_icon=!0,i.search_bar=!0,i.signin_link=!0),this.get("viewer")&&this.get("viewer").getValue("isPro")&&(i.stats=!0,i.get_pro_link=!1),"en-us"===this.appContext.lang.toLowerCase()&&(i.weekly_flickr=!0),this.signedOutTest&&(i.right_side_signup=!0),this.appContext.flipper.isFlipped("enable-photo-prints")&&(i.create_link=!1,i.prints_menu=!0),i},isExpiringPartnerAccount:function(){var e=this.get("viewer").getValue("expiringPartner");return this.appContext.flipper.isFlipped("enable-partner-account-banner")&&e&&-1===["embedr-route","site-key-route","browser-upgrade-interstitial-route","products-marketplace-eol-route","products-account-payouts-route","error-route"].indexOf(this.appContext.routeConfig.module)},handleToastPrimaryActionClick:function(t){var i=t&&t.clickEvent?t.clickEvent.target.getAttribute("href"):null;this.setToastDismissCookie(),i?e.config.win.location.href=i:this.toastSubview.dismiss()},handleToastSecondaryActionClick:function(t){var i=t&&t.clickEvent?t.clickEvent.target.getAttribute("href"):null;this.setToastDismissCookie(),i?e.config.win.location.href=i:this.toastSubview.dismiss()},setToastDismissCookie:function(){var e=new Date;e.setTime(e.getTime()+60*this.uploadLimitDismissHours*60*1e3),this.dontSetUploadLimitDismissCookie||this.appContext.setCookie({cookieName:this.toastDismissCookieName,cookieValue:1,expires:e,path:"/"})},setupToast:function(t){var i=!1,n=!1;this.toastSubview&&(this.appContext.flipper.isFlipped("enable-upload-limit-messages")?e.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext)?(n=!0,!t&&this.appContext.flipper.isFlipped("enable-photo-limit-overlay")&&(n="photostream-route"!==this.appContext.routeConfig.module&&"photo-route"!==this.appContext.routeConfig.module&&"products-flickrpro-route"!==this.appContext.routeConfig.module&&!this.appContext.getCookie(e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name)),!t&&this.appContext.flipper.isFlipped("enable-mega-limit-overlay")&&(n=this.appContext.getCookie(e.config.flickr.upload_blocking.dismiss_photo_limit_overlay_cookie_name)),n&&(this.toastSubview.setup({htmlContent:this.templates("upload-limit-message")({title:this.intlMessage({intlName:"upload-blocking.OVER_UPLOAD_LIMIT_HEAD_FINAL"}),description:this.intlMessage({intlName:"upload-blocking.OVER_UPLOAD_LIMIT_COPY_FINAL",limitCount:e.config.flickr.account.photo_limit.toLocaleString(this.appContext.lang,{maximumFractionDigits:0})}),primaryActionText:this.intlMessage({intlName:"common.GET_PRO"}),secondaryActionText:t?this.intlMessage({intlName:"common.DISMISS"}):this.intlMessage({intlName:"common.REMIND_ME_LATER"})}),classList:["urgent"]}),this.dontSetUploadLimitDismissCookie=t,this.uploadLimitDismissHours=e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_hours,this.toastDismissCookieName=e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name,i=!0)):e.UserLimitsHelper.hasReachedUploadLimit(this.profileModel,this.appContext)?(this.toastSubview.setup({htmlContent:this.templates("upload-limit-message")({title:this.intlMessage({intlName:"upload-blocking.AT_UPLOAD_LIMIT_HEAD"}),description:this.intlMessage({intlName:"upload-blocking.AT_UPLOAD_LIMIT_COPY_SHORT",limitCount:e.config.flickr.account.photo_limit.toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),limitedImagesUrl:"https://blog.flickr.net/en/2018/12/17/important-service-updates-and-dates-to-remember/?utm_campaign=flickr-launch-15&utm_source=Flickr&utm_medium=product&utm_content=big-blue",upgradeToProUrl:"/account/upgrade/pro"}),primaryActionText:this.intlMessage({intlName:"common.GET_PRO"}),secondaryActionText:this.intlMessage({intlName:"common.REMIND_ME_LATER"})})}),this.uploadLimitDismissHours=e.config.flickr.upload_blocking.dismiss_at_upload_limit_message_cookie_hours,this.toastDismissCookieName=e.config.flickr.upload_blocking.dismiss_at_upload_limit_message_cookie_name,i=!0):e.UserLimitsHelper.isNearUploadLimit(this.profileModel,this.appContext)&&(this.toastSubview.setup({htmlContent:this.templates("upload-limit-message")({title:this.intlMessage({intlName:"upload-blocking.UPLOADS_LOCKED_SOON_HEAD"}),description:this.intlMessage({intlName:"upload-blocking.UPLOADS_LOCKED_SOON_COPY",limitCount:e.config.flickr.account.photo_limit.toLocaleString(this.appContext.lang,{maximumFractionDigits:0}),limitedImagesUrl:"https://blog.flickr.net/en/2018/12/17/important-service-updates-and-dates-to-remember/?utm_campaign=flickr-launch-15&utm_source=Flickr&utm_medium=product&utm_content=big-blue",upgradeToProUrl:"/account/upgrade/pro"}),primaryActionText:this.intlMessage({intlName:"common.GET_PRO"}),secondaryActionText:this.intlMessage({intlName:"common.REMIND_ME_LATER"})})}),this.uploadLimitDismissHours=e.config.flickr.upload_blocking.dismiss_near_upload_limit_message_cookie_hours,this.toastDismissCookieName=e.config.flickr.upload_blocking.dismiss_near_upload_limit_message_cookie_name,i=!0):this.appContext.flipper.isFlipped("enable-upload-limit-warning")&&e.UserLimitsHelper.isNearUploadLimit(this.profileModel,this.appContext)&&(this.templates("upload-limit-warning")({}),this.toastSubview.setup({htmlContent:this.templates("upload-limit-warning")({})}),this.uploadLimitDismissHours=e.config.flickr.upload_blocking.dismiss_upload_limit_warning_cookie_hours,this.toastDismissCookieName=e.config.flickr.upload_blocking.dismiss_upload_limit_warning_cookie_name,i=!0),i&&this.toastDismissCookieName&&(t||!this.appContext.getCookie(this.toastDismissCookieName))&&(this.toastSubview.show(),this.toastSubview.on("primaryActionClicked",this.handleToastPrimaryActionClick.bind(this)),this.toastSubview.on("secondaryActionClicked",this.handleToastSecondaryActionClick.bind(this))))},handlePrintClick:function(){this.showPrintSelector()},showPrintSelector:function(){var t=this,i=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],n=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],o=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream",selected:!0},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets"}],a={appContext:this.appContext,searchable:{yours:!0,contacts:!1,everyone:!1,marketplace:!1}};this.printSelector=new e.Views["photo-selector-view"](a),this.printSelectorModal=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!1,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:"",navBarView:new e.Views["fluid-modal-nav-bar-view"]({appContext:this.appContext,links:i,enableSearch:!0,breakpointConfig:[{maxWidth:700,links:n,enableSearch:!1},{maxWidth:500,links:o,enableSearch:!1}]}),actionButtonLabel:"TMP Buy prints",actionButtonDisabled:!0,subview:this.printSelector,width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector",hideModalOverlay:!1}),this.printSelectorModal.show(),this.printSelectorModal.registerEventHandler(e.on("photoSelector:selected",function(e){t.printSelectorModal.enableActionButton()})),this.printSelectorModal.registerEventHandler(e.on("photoSelector:unselected",function(e){t.printSelectorModal.disableActionButton()})),this.printSelectorModal.on("actionClick",function(i){var n=t.printSelector.get("selected");t.registerPrintWithId(n).then(function(t){e.config.win.location.href=""})})},registerPrintWithId:function(t){var i={userId:this.appContext.getViewer().nsid,photoId:t};return e.Promise.resolve(i)},handleDrawerPageMouseDown:function(e){var t=e.target;t.ancestor(".mobile-nav-drawer",!0)||t.ancestor(".mobile-nav-toggle",!0)||this.hideMobileNavDrawer()},handleDrawerItemClick:function(e){this.hideMobileNavDrawer()},showMobileNavDrawer:function(){var t=this;this.get("container");this.contentContainer.addClass("drawer-open"),this.navDrawerShown=!0,this.navDrawer.addClass("shown"),clearTimeout(this.navDrawerOverlayHideTimeout),this.navDrawerOverlay&&(this.navDrawerOverlay.addClass("displayed"),setTimeout(function(){t.navDrawerOverlay.addClass("shown")},10)),this.drawerPageClickHandler||setTimeout(function(){t.drawerPageClickHandler=e.on(["mousedown","touchstart"],t.handleDrawerPageMouseDown.bind(t)),t.registerEventHandler(t.drawerPageClickHandler)},10)},hideMobileNavDrawer:function(){var e=this;this.get("container");this.contentContainer.removeClass("drawer-open"),this.navDrawerShown=!1,this.navDrawer.removeClass("shown"),this.navDrawerOverlay&&(this.navDrawerOverlay.removeClass("shown"),this.navDrawerOverlayHideTimeout=setTimeout(function(){e.navDrawerOverlay.removeClass("displayed")},500)),this.drawerPageClickHandler&&(this.detachRegisteredEvent(this.drawerPageClickHandler),this.drawerPageClickHandler=void 0)},createOutageWarningBanner:function(){var e=this;this.appContext.getView("outage-banner-view",{appContext:this.appContext}).then(function(t){e.createBanner(t,function(){e.headerBannerView.get("container").remove(),e.headerBannerView.destroy()})})},createLoginMigrationBanner:function(){var e=this;this.appContext.getView("login-migration-banner-view",{appContext:this.appContext}).then(function(t){e.createBanner(t,function(){e.headerBannerView.get("container").remove(),e.headerBannerView.destroy()})})},createBanner:function(e,t){var i=this,n=this.get("container").one(".nav-banner-container");this.appContext.getView("header-banner-view",{appContext:this.appContext,subview:e}).then(function(e){return i.headerBannerView=e,i.headerBannerView.on("dismiss",t),i.headerBannerView.initialize()}).then(function(){var e=i.headerBannerView.get("container");return n.empty(),n.appendChild(e),i.headerBannerView.activate()})},destructor:function(){clearTimeout(this.signUpInterstitialTimer),e.AnchorRepositioner.removeOffset(t)}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav","hermes-template-feedback-modal-view","hermes-template-upload-limit-warning","hermes-template-upload-limit-message","search-url","search-autosuggest-field-view","querystring-parse-simple","querystring-stringify-simple","notifications-menu-view","url-helper","person-menu-view","group-menu-view","browser-support","fluid-modal-view","signup-modal-view","signup-interstitial-view","signin-helper","storage-helper","partner-account-banner-view","featured-toast-view","user-limits-helper","photo-selector-view","fluid-modal-nav-bar-view","mega-limit-overlay-view"],langBundles:["global-nav","common","search","upload-blocking"]});YUI.add("hermes-lang-global-nav",function(o,e){o.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],FLICKR_GALLERIES:["Flickr Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"],CAMERAROLL:["Camera Roll"],CREATE:["Create"],CREATE_NEW:["New Creation"],CREATE_MY_WALLART:["My Wall Art"],CREATE_MY_PHOTOS_BOOKS:["My Photo Books"],CREATE_ORDER_HISTORY:["My Order History"],UPLOAD_MODAL_SIGNUP_TITLE:["Upload your photos securely and privately!"],UPLOAD_MODAL_SIGNUP_MESSAGE:["Join Flickr to unlock 1,000GB of free photo storage."],HOME:["Home"],LOG_IN:["Log In"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-template-google-analytics",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,l,s){var i,t,r=null!=a?a:{},c=n.helperMissing,p=e.escapeExpression;return'<script nonce="'+p("function"==typeof(t=null!=(t=n.cspNonce||(null!=a?a.cspNonce:a))?t:c)?t.call(r,{name:"cspNonce",hash:{},data:s}):t)+'">window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;<\/script>\n<script nonce="'+p("function"==typeof(t=null!=(t=n.cspNonce||(null!=a?a.cspNonce:a))?t:c)?t.call(r,{name:"cspNonce",hash:{},data:s}):t)+"\" async src='https://www.google-analytics.com/analytics"+(null!=(i=(n.isFlipped||a&&a.isFlipped||c).call(r,"enable-google-analytics-debugging",{name:"isFlipped",hash:{},fn:e.program(2,s,0),inverse:e.noop,data:s}))?i:"")+".js'><\/script>\n"},2:function(e,a,n,l,s){return"_debug"},compiler:[7,">= 4.0.0"],main:function(e,a,n,l,s){var i;return null!=(i=(n.isFlipped||a&&a.isFlipped||n.helperMissing).call(null!=a?a:{},"enable-google-analytics",{name:"isFlipped",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?i:""},useData:!0}),l={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(l[a]=n)}),e.Template.register("hermes/google-analytics",function(a,s){return s=s||{},s.partials=s.partials?e.merge(l,s.partials):l,n(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-adobe-analytics",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,l,s){var r,t=null!=a?a:{},i=n.helperMissing,c=e.escapeExpression;return'<script nonce="'+c("function"==typeof(r=null!=(r=n.cspNonce||(null!=a?a.cspNonce:a))?r:i)?r.call(t,{name:"cspNonce",hash:{},data:s}):r)+'" src="'+c("function"==typeof(r=null!=(r=n.adobeAnalyticsUrl||(null!=a?a.adobeAnalyticsUrl:a))?r:i)?r.call(t,{name:"adobeAnalyticsUrl",hash:{},data:s}):r)+'" async><\/script>\n'},compiler:[7,">= 4.0.0"],main:function(e,a,n,l,s){var r;return null!=(r=(n.isFlipped||a&&a.isFlipped||n.helperMissing).call(null!=a?a:{},"enable-adobe-analytics",{name:"isFlipped",hash:{},fn:e.program(1,s,0),inverse:e.noop,data:s}))?r:""},useData:!0}),l={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(l[a]=n)}),e.Template.register("hermes/adobe-analytics",function(a,s){return s=s||{},s.partials=s.partials?e.merge(l,s.partials):l,n(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-google-tag-manager",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,t,l){var r,s=null!=a?a:{},i=n.helperMissing,o=e.escapeExpression;return'<script nonce="'+o("function"==typeof(r=null!=(r=n.cspNonce||(null!=a?a.cspNonce:a))?r:i)?r.call(s,{name:"cspNonce",hash:{},data:l}):r)+"\">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.nonce='"+o("function"==typeof(r=null!=(r=n.cspNonce||(null!=a?a.cspNonce:a))?r:i)?r.call(s,{name:"cspNonce",hash:{},data:l}):r)+"';j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-WS6KDNW');<\/script>\n<noscript><iframe src=\"https://www.googletagmanager.com/ns.html?id=GTM-WS6KDNW\" height=\"0\" width=\"0\" style=\"display:none;visibility:hidden\"></iframe></noscript>\n"},compiler:[7,">= 4.0.0"],main:function(e,a,n,t,l){var r;return null!=(r=(n.isFlipped||a&&a.isFlipped||n.helperMissing).call(null!=a?a:{},"enable-google-tag-manager",{name:"isFlipped",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?r:""},useData:!0}),t={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/google-tag-manager",function(a,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,n(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});